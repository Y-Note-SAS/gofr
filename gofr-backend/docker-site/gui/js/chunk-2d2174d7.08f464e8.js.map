{"version":3,"sources":["webpack:///./src/components/gofr/gofr-secondary.vue?786d","webpack:///src/components/gofr/gofr-secondary.vue","webpack:///./src/components/gofr/gofr-secondary.vue?78c9","webpack:///./src/components/gofr/gofr-secondary.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","edit","_e","staticClass","attrs","columns","items","loading","scopedSlots","_u","key","fn","_v","_s","$t","title","_l","action","text","setupLink","link","class","proxy","ref","item","staticRenderFns","name","props","data","source","empty","topActions","mounted","setupData","watch","methods","url","$store","state","config","userConfig","FRDatasource","resource","linkId","searchField","field","queryStr","push","join","addItems","console","log","err","processContent","replace","component","VBtn","VContainer","VDataTable","VSpacer","VToolbar","VToolbarTitle"],"mappings":"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","file":"js/chunk-2d2174d7.08f464e8.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return (!_vm.edit)?_c('v-container',{staticClass:\"my-3\"},[_c('v-data-table',{staticClass:\"elevation-1\",attrs:{\"headers\":_vm.columns,\"items\":_vm.items,\"item-key\":\"id\",\"items-per-page\":5,\"loading\":_vm.loading,\"dense\":\"\"},scopedSlots:_vm._u([{key:\"top\",fn:function(){return [_c('v-toolbar',{attrs:{\"flat\":\"\",\"color\":\"white\"}},[_c('v-toolbar-title',[_vm._v(\" \"+_vm._s(_vm.$t((\"App.fhir-resources-texts.\" + _vm.title)))+\" \")]),_c('v-spacer'),_vm._l((_vm.topActions),function(action){return _c('v-btn',{key:action.text,attrs:{\"to\":_vm.setupLink( action.link, {} ),\"color\":action.class,\"small\":\"\"}},[_vm._v(\" \"+_vm._s(action.text)+\" \")])})],2)]},proxy:true},{key:\"item._action\",fn:function(ref){\nvar item = ref.item;\nreturn _vm._l((item.actions),function(action){return _c('v-btn',{key:action.text,attrs:{\"to\":_vm.setupLink( action.link, item ),\"color\":action.class,\"small\":\"\",\"rounded\":\"\"}},[_vm._v(\" \"+_vm._s(_vm.$t((\"App.fhir-resources-texts.\" + (action.text))))+\" \")])})}}],null,false,1456901422)})],1):_vm._e()}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <v-container class=\"my-3\" v-if=\"!edit\">\n    <v-data-table\n      :headers=\"columns\"\n      :items=\"items\"\n      item-key=\"id\"\n      :items-per-page=\"5\"\n      :loading=\"loading\"\n      class=\"elevation-1\"\n      dense\n    >\n\n      <template v-slot:top>\n        <v-toolbar flat color=\"white\">\n          <v-toolbar-title>\n            {{ $t(`App.fhir-resources-texts.${title}`) }}\n          </v-toolbar-title>\n          <v-spacer></v-spacer>\n          <v-btn\n            v-for=\"action in topActions\"\n            :to=\"setupLink( action.link, {} )\"\n            :color=\"action.class\"\n            :key=\"action.text\"\n            small\n            >\n            {{ action.text }}\n          </v-btn>\n        </v-toolbar>\n      </template>\n      <template v-slot:item._action=\"{ item }\">\n        <v-btn\n          v-for=\"action in item.actions\"\n          :to=\"setupLink( action.link, item )\"\n          :color=\"action.class\"\n          :key=\"action.text\"\n          small\n          rounded\n          >\n          {{ $t(`App.fhir-resources-texts.${action.text}`) }}\n        </v-btn>\n      </template>\n    </v-data-table>\n  </v-container>\n</template>\n\n<script>\nimport axios from 'axios'\nconst isObject = (obj) => {\n  return (!!obj) && (obj.constructor === Object)\n}\n\nexport default {\n  name: \"gofr-secondary\",\n  props: [\"title\", \"field\", \"profile\", \"slotProps\", \"link-id\", \"link-field\",\n    \"search-field\", \"edit\", \"columns\", \"actions\"],\n  data: function() {\n    return {\n      source: { data: {}, path: this.field },\n      empty: true,\n      items: [],\n      loading: true,\n      topActions: []\n    }\n  },\n  mounted: function() {\n    this.setupData()\n  },\n  watch: {\n    /*\n    slotProps: {\n      handler() {\n        this.setupData()\n      },\n      deep: true\n    }\n    */\n  },\n  methods: {\n    setupData: function() {\n      let url\n      //for searchfield in the form Location:organization with Location being the primary resource, then use _include to retrieve secondary resources\n      if(this.searchField.split(':').length === 2) {\n        let resource = this.searchField.split(':')[0]\n        url = \"fhir/\" + this.$store.state.config.userConfig.FRDatasource + \"/\" + resource + \"?_id=\" + this.linkId + \"&_include=\" + this.searchField\n      } else {\n        url = \"/fhir/\" + this.$store.state.config.userConfig.FRDatasource + \"/\" + this.field\n        let queryStr = []\n        if ( this.profile ) {\n          queryStr.push( \"_profile=\"+this.profile )\n        }\n        if ( this.searchField ) {\n          queryStr.push( this.searchField+\"=\"+this.linkId )\n        } else {\n          queryStr.push( this.linkField.substring( this.linkField.indexOf('.') +1 ) +\"=\"+this.linkId )\n        }\n        url += \"?\" + queryStr.join(\"&\")\n      }\n      this.items = []\n      this.loading = true\n      this.addItems( url )\n    },\n    addItems: function (url) {\n      axios.get( url ).then( async (response) => {\n        let data = response.data\n        if ( data.entry && data.entry.length > 0 ) {\n          for( let entry of data.entry ) {\n            if(this.searchField.split(':').length === 2 && entry.resource.resourceType === this.searchField.split(':')[0]) {\n              continue\n            }\n            let row = { id: entry.resource.id }\n            for( let header of this.columns ) {\n              if ( header.value === \"_action\" ) continue\n              try {\n                let content = this.$fhirpath.evaluate( entry.resource, header.value )\n                row[header.value] = await this.processContent( content )\n              } catch ( err ) {\n                console.log(err)\n              }\n            }\n            if ( !row.actions ) row.actions = []\n            for( let action of this.actions ) {\n              if ( action.row ) {\n                if ( action.condition ) {\n                  let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                  if ( meets.every( meet => meet ) ) {\n                    row.actions.push( action )\n                  }\n                } else {\n                  row.actions.push( action )\n                }\n              } else {\n                if ( action.condition ) {\n                  let meets = this.$fhirpath.evaluate( entry.resource, action.condition )\n                  if ( action.hasOwnProperty(\"meets\") ) {\n                    action.meets = action.meets && meets.every( meet => meet )\n                  } else {\n                    action.meets = meets.every( meet => meet )\n                  }\n                } else {\n                  action.meets = true\n                }\n              }\n            }\n            this.items.push( row )\n          }\n        } else {\n          for( let action of this.actions ) {\n            if ( !action.row ) {\n              action.meets = action.emptyDisplay\n            }\n          }\n        }\n        this.topActions = this.actions.filter( action => !action.row && action.meets )\n\n\n        if ( data.link ) {\n          let next = data.link.find( link => link.relation === \"next\" )\n          if ( next ) {\n            this.addItems( next.url )\n          } else {\n            this.loading = false\n          }\n        } else {\n          this.loading = false\n        }\n      } ).catch( err => {\n        this.loading = false\n        console.log(err)\n      } )\n\n    },\n    processContent: async function( content ) {\n      if ( Array.isArray( content ) ) {\n        let output = await Promise.all(content.map( this.processContent ))\n        return output.join(\" \")\n      } else if ( isObject( content ) ) {\n        if ( content.code && content.system ) {\n          return await this.$fhirutils.codeLookup( content.system, content.code )\n        } else if ( content.display ) {\n          return content.display\n        } else if ( content.code ) {\n          return content.code\n        } else if ( content.reference ) {\n          return await this.$fhirutils.resourceLookup( content.reference)\n        } else {\n          console.log(\"Unable to process content:\",content)\n          return \"Unknown\"\n        }\n      } else {\n        return content\n      }\n    },\n    setupLink( link, item ) {\n      return link.replace( \"ITEMID\", item.id ).replace( \"FHIRID\", this.linkId )\n    }\n  }\n}\n\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./gofr-secondary.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./gofr-secondary.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./gofr-secondary.vue?vue&type=template&id=3b4ea4a2&\"\nimport script from \"./gofr-secondary.vue?vue&type=script&lang=js&\"\nexport * from \"./gofr-secondary.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VContainer } from 'vuetify/lib/components/VGrid';\nimport { VDataTable } from 'vuetify/lib/components/VDataTable';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VBtn,VContainer,VDataTable,VSpacer,VToolbar,VToolbarTitle})\n"],"sourceRoot":""}