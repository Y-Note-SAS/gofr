(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a6b076a"],{"91dd":function(e,t,r){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,r,a){t=t||"&",r=r||"=";var s={};if("string"!==typeof e||0===e.length)return s;var o=/\+/g;e=e.split(t);var c=1e3;a&&"number"===typeof a.maxKeys&&(c=a.maxKeys);var u=e.length;c>0&&u>c&&(u=c);for(var l=0;l<u;++l){var h,p,d,f,v=e[l].replace(o,"%20"),m=v.indexOf(r);m>=0?(h=v.substr(0,m),p=v.substr(m+1)):(h=v,p=""),d=decodeURIComponent(h),f=decodeURIComponent(p),i(s,d)?n(s[d])?s[d].push(f):s[d]=[s[d],f]:s[d]=f}return s};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},b383:function(e,t,r){"use strict";t.decode=t.parse=r("91dd"),t.encode=t.stringify=r("e099")},e099:function(e,t,r){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,r,o){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"===typeof e?a(s(e),(function(s){var o=encodeURIComponent(i(s))+r;return n(e[s])?a(e[s],(function(e){return o+encodeURIComponent(i(e))})).join(t):o+encodeURIComponent(i(e[s]))})).join(t):o?encodeURIComponent(i(o))+r+encodeURIComponent(i(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var r=[],i=0;i<e.length;i++)r.push(t(e[i],i));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},ed40:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return"tree"==e.displayType?r("v-menu",{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px","max-height":"500px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on;return[r("v-text-field",e._g({attrs:{label:e.$t("App.fhir-resources-texts."+e.display),outlined:"","hide-details":"auto",loading:e.loading,dense:"",shaped:"",clearable:""},on:{"click:clear":function(t){return e.clearSearch()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(e._s(e.$t("App.fhir-resources-texts."+e.display)))]},proxy:!0}],null,!0),model:{value:e.displayValue,callback:function(t){e.displayValue=t},expression:"displayValue"}},i))]}}],null,!1,3505724966),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[r("v-card",[r("v-treeview",{attrs:{active:e.active,items:e.items,"load-children":e.fetchChildren,open:e.open,"item-disabled":"locked",activatable:"","multiple-active":!1,"selection-type":"independent",loading:e.loading},on:{"update:active":function(t){e.active=t},"update:open":function(t){e.open=t}}})],1)],1):r("v-autocomplete",{attrs:{loading:e.loading,items:e.items,"search-input":e.search,"cache-items":"",flat:"","hide-no-data":"","hide-details":"",label:e.$t("App.fhir-resources-texts."+e.display),outlined:"",dense:"",placeholder:"Start typing for selection"},on:{"update:searchInput":function(t){e.search=t},"update:search-input":function(t){e.search=t},"click:clear":function(t){return e.clearSearch()}},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(e._s(e.$t("App.fhir-resources-texts."+e.display)))]},proxy:!0}]),model:{value:e.select,callback:function(t){e.select=t},expression:"select"}})},n=[],a=r("b85c"),s=r("1da1"),o=(r("96cf"),r("ac1f"),r("841c"),r("5319"),r("d3b7"),r("caad"),r("2532"),r("b0c0"),r("9911"),r("7db0"),r("8a79"),r("bc3a")),c=r.n(o),u=r("b383"),l="http://hl7.org/fhir/StructureDefinition/",h={name:"fhir-reference",props:["field","label","expression","targetProfile","targetResource","slotProps","edit","readOnlyIfSet","displayType","initialValue","overrideValue"],data:function(){return{source:{path:"",data:{}},value:{reference:""},qField:"valueReference",loading:!1,search:"",menu:!1,items:[],select:"",resource:"",awaitingSearch:!1,displayValue:"",preset:!1,disabled:!1,errors:[],lockWatch:!1,active:[],open:[],treeLookup:{},allAllowed:!0}},created:function(){this.setupData()},watch:{slotProps:{handler:function(){this.lockWatch||this.setupData()},deep:!0},search:function(e){var t=this;this.awaitingSearch||setTimeout((function(){e&&e.length>1&&t.querySelections(t.search),t.awaitingSearch=!1}),500),this.awaitingSearch=!0},select:function(e){this.value.reference=e,this.updateSearch()},active:function(){this.active.length?(this.select=this.active[0],this.displayValue=this.treeLookup[this.select]):(this.select=void 0,this.displayValue=""),this.menu=!1}},methods:{updateSearch:function(){this.$emit("termChange",this.expression,this.value.reference)},clearSearch:function(){this.$emit("termChange",this.expression,[])},setupData:function(){if(this.targetProfile&&this.targetResource&&(this.targetProfile.replace(l,"")===this.targetResource?this.allAllowed=!0:this.allAllowed=!1,this.resource=this.targetResource),"tree"===this.displayType&&this.setupTreeItems(),this.slotProps&&this.slotProps.source){if(this.source={path:this.slotProps.source.path+"."+this.field,data:{}},this.slotProps.source.fromArray)this.source.data=this.slotProps.source.data;else{var e=this.$fhirutils.pathFieldExpression(this.field),t=this.$fhirpath.evaluate(this.slotProps.source.data,e);this.source.data=t[0]}this.source.data&&(this.preset=!0,this.select=this.source.data.reference,this.lockWatch=!0)}this.disabled=this.readOnlyIfSet&&this.preset},setupTreeItems:function(){var e=this.initialValue;this.overrideValue&&(e=this.overrideValue),this.loading=!0;var t={};t=e?{partof:e}:{"partof:missing":!0},t._count=200;var r="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(t);this.items=[],this.addItems(r,this.items)},checkChildren:function(e){var t={partof:e.id,_summary:"count"},r="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(t);return new Promise((function(t){c.a.get(r).then((function(r){var i=r.data;i.total&&i.total>0&&(e.children=[]),t()})).catch((function(e){console.log("failed to check children for",r,e),t()}))}))},addItems:function(e,t){var r=this;c.a.get(e).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(i){var n,s,o,c,u,l,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=i.data,!(n.entry&&n.entry.length>0)){e.next=23;break}s=Object(a["a"])(n.entry),e.prev=3,s.s();case 5:if((o=s.n()).done){e.next=15;break}return c=o.value,u=!r.allAllowed&&(!c.resource.meta.profile||!c.resource.meta.profile.includes(r.targetProfile)),l={id:c.resource.resourceType+"/"+c.resource.id,name:c.resource.name,locked:u},e.next=11,r.checkChildren(l);case 11:r.treeLookup[l.id]=l.name,t.push(l);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](3),s.e(e.t0);case 20:return e.prev=20,s.f(),e.finish(20);case 23:n.link?(h=n.link.find((function(e){return"next"===e.relation})),h?r.addItems(h.url,t):r.loading=!1):r.loading=!1;case 24:case"end":return e.stop()}}),e,null,[[3,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(t){console.log("Failed to add items for",e,t),r.loading=!1}))},fetchChildren:function(e){var t=this,r={};r={partof:e.id,_count:500};var i="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(r);return this.loading=!0,this.addItems(i,e.children),new Promise((function(e){var r=0,i=function i(){!t.loading||r++>100?e():setTimeout(i,200)};i()}))},querySelections:function(e){var t=this;this.loading=!0;var r={"name:contains":e};this.targetProfile.endsWith(this.resource)||(r._profile=this.targetProfile);var i="/fhir/"+this.$store.state.config.userConfig.FRDatasource+"/"+this.resource+"?"+u.stringify(r);c.a.get(i).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(r){var i,n,s,o,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=r.data,t.items=[],!i.entry||!i.entry.length){e.next=24;break}n=Object(a["a"])(i.entry),e.prev=4,n.s();case 6:if((s=n.n()).done){e.next=16;break}return o=s.value,c=o.resource.resourceType+"/"+o.resource.id,u={value:c},e.next=12,t.$fhirutils.resourceLookup(c);case 12:u.text=e.sent,t.items.push(u);case 14:e.next=6;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e["catch"](4),n.e(e.t0);case 21:return e.prev=21,n.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[4,18,21,24]])})));return function(t){return e.apply(this,arguments)}}())}},computed:{index:function(){return this.slotProps?this.slotProps.input:void 0},display:function(){return this.slotProps&&this.slotProps.input?this.slotProps.input.label:this.label}}},p=h,d=r("2877"),f=r("6544"),v=r.n(f),m=r("c6a6"),g=r("b0af"),y=r("e449"),b=r("8654"),x=r("eb2a"),k=Object(d["a"])(p,i,n,!1,null,null,null);t["default"]=k.exports;v()(k,{VAutocomplete:m["a"],VCard:g["a"],VMenu:y["a"],VTextField:b["a"],VTreeview:x["a"]})}}]);
//# sourceMappingURL=chunk-0a6b076a.622831ac.js.map